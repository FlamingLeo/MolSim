# .github/workflows/clang-format.yml
name: Auto-format with Clang Format

on:
    push:
        branches:
            - master
    pull_request:
        branches:
            - master

jobs:
    format:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout the repository
              uses: actions/checkout@v3

            - name: Set up clang-format
              run: sudo apt-get install clang-format

            - name: Run clang-format
              run: |
                  find . -regex '.*\.\(cpp\|hpp\|cc\|hh\|c\|h\)' -exec clang-format -i {} \;

            - name: Commit changes
              run: |
                  git config --global user.name "github-actions[bot]"
                  git config --global user.email "github-actions[bot]@users.noreply.github.com"
                  git add .
                  git commit -m "Apply clang-format"
              continue-on-error: true

            - name: Push changes
              run: |
                  git push origin master
              if: success()
